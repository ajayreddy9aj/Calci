<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sambashiva Milk Agency</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #fffaf4;
      margin: 0;
      padding: 0;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: linear-gradient(90deg, #ffb347, #ffcc33);
      color: #fff;
      text-align: center;
      padding: 12px 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .title-section {
      flex: 1;
      text-align: center;
      position: relative;
    }
    .icon {
      width: 32px;
      height: 32px;
      vertical-align: middle;
      animation: spin 8s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      color: #4a2c00;
    }
    h2 {
      margin: 0;
      font-size: 12px;
      color: #4a2c00;
    }
    .date-box {
      background: #fff;
      color: #4a2c00;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: center;
    }
    th {
      background-color: #ffb347;
      color: #fff;
      position: sticky;
      top: 80px;
      z-index: 5;
    }
    input {
      width: 55px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 4px;
      font-size: 12px;
    }
    .button-bar {
      margin: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
    }
    button {
      background: #ffb347;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { background: #ff9900; }
    .summary {
      text-align: center;
      margin: 15px 0;
      font-weight: 600;
      color: #4a2c00;
    }
  </style>
</head>
<body>
  <header>
    <img class="icon" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/Lotus_flower.svg/2048px-Lotus_flower.svg.png" alt="lotus" />
    <div class="title-section">
      <h1>SAMBASHIVA MILK AGENCY</h1>
      <h2>Prop: K. AJAY KUMAR REDDY<br>Mobile: 7330892694</h2>
    </div>
    <div>
      <input type="date" id="datePicker" class="date-box" />
    </div>
  </header>

  <div class="button-bar">
    <button id="addShop">+ Add Shop</button>
    <button id="saveData">Save Data</button>
    <button id="downloadCSV">Download CSV</button>
    <button id="clearAll">Clear All</button>
  </div>

  <table id="milkTable">
    <thead>
      <tr>
        <th>Shop</th>
        <th>Mobile</th>
        <th>TM</th>
        <th>SM</th>
        <th>SMALL M</th>
        <th>SMALL C</th>
        <th>A400</th>
        <th>H500</th>
        <th>FC400</th>
        <th>FC1L</th>
        <th>Total</th>
        <th>Paid</th>
        <th>Due</th>
        <th>Send</th>
        <th>Del</th>
      </tr>
      <tr>
        <th colspan="2">Planned litres</th>
        <th contenteditable="true" id="planTM">0</th>
        <th contenteditable="true" id="planSM">0</th>
        <th contenteditable="true" id="planSMM">0</th>
        <th contenteditable="true" id="planSMC">0</th>
        <th contenteditable="true" id="planA400">0</th>
        <th contenteditable="true" id="planH500">0</th>
        <th contenteditable="true" id="planFC400">0</th>
        <th contenteditable="true" id="planFC1L">0</th>
        <th colspan="5"></th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
    <tfoot>
      <tr id="soldRow">
        <th colspan="2">Litres Sold</th>
        <td id="soldTM">0</td>
        <td id="soldSM">0</td>
        <td id="soldSMM">0</td>
        <td id="soldSMC">0</td>
        <td id="soldA400">0</td>
        <td id="soldH500">0</td>
        <td id="soldFC400">0</td>
        <td id="soldFC1L">0</td>
        <td colspan="5"></td>
      </tr>
      <tr id="remainRow">
        <th colspan="2">Litres Remaining</th>
        <td id="remTM">0</td>
        <td id="remSM">0</td>
        <td id="remSMM">0</td>
        <td id="remSMC">0</td>
        <td id="remA400">0</td>
        <td id="remH500">0</td>
        <td id="remFC400">0</td>
        <td id="remFC1L">0</td>
        <td colspan="5"></td>
      </tr>
    </tfoot>
  </table>

  <div class="summary" id="grandTotal">Grand Total: ₹0</div>

  <script>
    const prices = { TM:57, SM:67, 'SMALL M':45, 'SMALL C':45, A400:70, H500:86, FC400:77, FC1L:76 };
    const tableBody = document.getElementById('tableBody');
    const grandTotal = document.getElementById('grandTotal');
    const datePicker = document.getElementById('datePicker');
    const clearBtn = document.getElementById('clearAll');

    function todayStr(){return new Date().toISOString().split('T')[0];}
    datePicker.value = todayStr();

    function loadData(){
      const data = JSON.parse(localStorage.getItem('milkData_'+datePicker.value))||[];
      render(data);
    }

    function saveData(){
      const rows = [...tableBody.children].map(r=>{
        const cells = r.querySelectorAll('input');
        return {
          shop:cells[0].value, mobile:cells[1].value,
          TM:+cells[2].value||0, SM:+cells[3].value||0,
          SMM:+cells[4].value||0, SMC:+cells[5].value||0,
          A400:+cells[6].value||0, H500:+cells[7].value||0,
          FC400:+cells[8].value||0, FC1L:+cells[9].value||0,
          paid:+cells[11].value||0
        };
      });
      localStorage.setItem('milkData_'+datePicker.value, JSON.stringify(rows));
    }

    function render(data){
      tableBody.innerHTML='';
      data.forEach(addRow);
      updateTotals();
    }

    function addRow(obj={}){
      const row=document.createElement('tr');
      const fields=['shop','mobile','TM','SM','SMM','SMC','A400','H500','FC400','FC1L','total','paid','due'];
      fields.forEach(f=>{
        const td=document.createElement('td');
        if(f==='total'||f==='due'){td.textContent='0';}
        else if(f==='send'){td.innerHTML='<button>Send</button>';}
        else if(f==='del'){td.innerHTML='<button>Del</button>';}
        else{
          const inp=document.createElement('input');
          inp.value=obj[f]||'';
          inp.oninput=updateTotals;
          td.appendChild(inp);
        }
        row.appendChild(td);
      });
      const sendTd=document.createElement('td');
      const sendBtn=document.createElement('button');
      sendBtn.textContent='Send';
      sendBtn.onclick=()=>sendWhatsApp(row);
      sendTd.appendChild(sendBtn);
      row.appendChild(sendTd);

      const delTd=document.createElement('td');
      const delBtn=document.createElement('button');
      delBtn.textContent='Del';
      delBtn.onclick=()=>{row.remove();updateTotals();};
      delTd.appendChild(delBtn);
      row.appendChild(delTd);

      tableBody.appendChild(row);
    }

    function updateTotals(){
      let gTotal=0;
      let sold={TM:0,SM:0,SMM:0,SMC:0,A400:0,H500:0,FC400:0,FC1L:0};
      [...tableBody.children].forEach(r=>{
        const c=r.querySelectorAll('input');
        const counts={TM:+c[2].value||0, SM:+c[3].value||0, SMM:+c[4].value||0, SMC:+c[5].value||0,
                      A400:+c[6].value||0, H500:+c[7].value||0, FC400:+c[8].value||0, FC1L:+c[9].value||0};
        let total=0; for(const k in prices){total+=counts[k]*prices[k]; sold[k]+=counts[k];}
        gTotal+=total;
        c[10].parentElement.textContent=total;
        const paid=+c[11].value||0;
        c[12].parentElement.textContent=total-paid;
      });
      grandTotal.textContent='Grand Total: ₹'+gTotal;
      ['TM','SM','SMM','SMC','A400','H500','FC400','FC1L'].forEach(k=>{
        document.getElementById('sold'+k).textContent=sold[k];
        const plan=parseFloat(document.getElementById('plan'+k).textContent)||0;
        document.getElementById('rem'+k).textContent=(plan-sold[k]);
      });
      saveData();
    }

    function sendWhatsApp(row){
      const c=row.querySelectorAll('input');
      const shop=c[0].value, mobile=c[1].value;
      let msg=`${shop} Milk Details:\n`;
      Object.keys(prices).forEach((k,i)=>{msg+=`${k}: ${c[2+i].value}\n`;});
      msg+=`Total: ₹${c[10].parentElement.textContent}`;
      window.open(`https://wa.me/91${mobile}?text=${encodeURIComponent(msg)}`);
    }

    document.getElementById('addShop').onclick=()=>{addRow();};
    document.getElementById('saveData').onclick=saveData;
    document.getElementById('downloadCSV').onclick=()=>{
      let csv='Shop,Mobile,TM,SM,SMALL M,SMALL C,A400,H500,FC400,FC1L,Total,Paid,Due\n';
      [...tableBody.children].forEach(r=>{
        csv+=[...r.querySelectorAll('input')].map(i=>i.value).join(',')+'\n';
      });
      const blob=new Blob([csv],{type:'text/csv'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download=`milk${datePicker.value}.csv`;
      a.click();
    };
    clearBtn.onclick=()=>{
      if(confirm('Clear all data?')){
        localStorage.removeItem('milkData_'+datePicker.value);
        tableBody.innerHTML='';
        updateTotals();
      }
    };
    datePicker.onchange=loadData;
    loadData();
  </script>
</body>
</html>
