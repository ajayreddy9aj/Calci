<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Retail Sales Tracker</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f1724; --muted:#9ca3af; --accent:#06b6d4; --success:#16a34a; --danger:#ef4444; --card:#0b1220; --border:#16202a; --header:#0ea5e9;
    }
    body { font-family: Arial, sans-serif; padding: 18px; background: var(--bg); color: #e6eef6; }
    h1 { text-align: center; position: relative; margin-bottom: 6px; color: #e6eef6; }
    #totalDisplay { position: absolute; right: 20px; top: 0; font-size: 15px; color: var(--bg); background: var(--accent); padding: 6px 10px; border-radius: 6px; }
    #grandTotal { position: absolute; right: 260px; top: 0; font-size: 15px; color: var(--bg); background: #94f9e9; padding: 6px 10px; border-radius: 6px; border:1px solid rgba(255,255,255,0.04); }
    table { width: 100%; border-collapse: collapse; margin-top: 26px; background: transparent; }
    th, td { border: 1px solid rgba(255,255,255,0.06); padding: 6px; text-align: center; font-size: 13px; }
    th { background-color: rgba(255,255,255,0.03); color: #dbeafe; }
    button { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; }
    .edit { background: var(--header); color: #06202a; width: 100px; }
    .send { background: var(--success); color: #06202a; width: 100px; }
    .delete { background: var(--danger); color: white; }
    input[type='number'] { width: 38px; text-align: center; font-size: 13px; background: rgba(255,255,255,0.03); color: #e6eef6; border:1px solid rgba(255,255,255,0.04); padding:4px; border-radius:4px }
    input[type='text'] { width: 90px; text-align: center; font-size: 13px; background: rgba(255,255,255,0.03); color: #e6eef6; border:1px solid rgba(255,255,255,0.04); padding:4px; border-radius:4px }
    .mobile-input { width: 120px; }
    .paid-input { width: 80px; }
    .due-input { width: 80px; }
    #priceModal { display:none; position:fixed; top:35%; left:50%; transform:translate(-50%,-50%); background:var(--panel); border:1px solid rgba(255,255,255,0.04); padding:28px; border-radius:12px; box-shadow:0 6px 30px rgba(0,0,0,0.6); width:360px; color:#e6eef6 }
    #priceModal input { width:100px; background: rgba(255,255,255,0.03); color: #e6eef6; border:1px solid rgba(255,255,255,0.04); padding:6px; border-radius:6px }
    #priceModal button { margin-top:10px; }
    #priceModal h3 { text-align:center; margin-bottom:8px; }
    small { display:block; font-size:11px; color:var(--muted); }
    .totals-row th { background: rgba(255,255,255,0.02); font-weight:bold; }
    .controls { margin-top:12px; display:flex; gap:8px; }
  </style>
</head>
<body>
  <h1>üßæ <span id="dateTitle">Daily Retail Sales Tracker</span> <span id="grandTotal">Grand Total: ‚Çπ0</span></h1>
  <label><strong>Date:</strong> <input type="date" id="dateField" onchange="updateDate()" /></label>
  <div class="controls">
    <button id="addBtn" onclick="addRow()">‚ûï Add Customer</button>
    <button id="saveBtn" onclick="saveCurrentDate()">üíæ Save</button>
    <button id="printBtn" onclick="openPrintView()">üñ®Ô∏è Print / PDF</button>
  </div>  <div class="table-container" style="overflow:auto; margin-top:12px;">
  <table id="salesTable">
    <thead>
      <tr class="totals-row">
        <th style="min-width:80px">Totals</th>
        <th style="min-width:40px">-</th>
        <th id="t_TM500">0L</th>
        <th id="t_S_Milk">0L</th>
        <th id="t_S_Curd">0L</th>
        <th id="t_B_Curd">0L</th>
        <th id="t_H500">0L</th>
        <th id="t_FCM500">0L</th>
        <th id="t_FCM1L">0L</th>
        <th id="t_SM1L">0L</th>
        <th colspan="5"></th>
      </tr>
      <tr>
        <th style="min-width:120px">Customer Name</th>
        <th style="min-width:130px">Mobile</th>
        <th style="min-width:50px">TM500 <small>‚Çπ56/L</small></th>
        <th style="min-width:50px">S Milk <small>‚Çπ45/L</small></th>
        <th style="min-width:50px">S Curd <small>‚Çπ45/L</small></th>
        <th style="min-width:50px">B Curd <small>‚Çπ68/L</small></th>
        <th style="min-width:50px">H500 <small>‚Çπ86/L</small></th>
        <th style="min-width:50px">FCM500 <small>‚Çπ77/L</small></th>
        <th style="min-width:50px">FCM1L <small>‚Çπ72/L</small></th>
        <th style="min-width:50px">SM1L <small>‚Çπ66/L</small></th>
        <th style="min-width:80px">Paid (‚Çπ)</th>
        <th style="min-width:80px">Due (‚Çπ)</th>
        <th style="min-width:90px">Edit</th>
        <th style="min-width:90px">Send</th>
        <th style="min-width:70px">Delete</th>
      </tr>
    </thead>
    <tbody id="salesBody"></tbody>
  </table>
  </div>  <div id="priceModal">
    <h3>Edit Prices for Customer</h3>
    <table>
      <tr><td>TM500:</td><td><input type="number" id="p_TM500" /></td></tr>
      <tr><td>S Milk:</td><td><input type="number" id="p_S_Milk" /></td></tr>
      <tr><td>S Curd:</td><td><input type="number" id="p_S_Curd" /></td></tr>
      <tr><td>B Curd:</td><td><input type="number" id="p_B_Curd" /></td></tr>
      <tr><td>H500:</td><td><input type="number" id="p_H500" /></td></tr>
      <tr><td>FCM500:</td><td><input type="number" id="p_FCM500" /></td></tr>
      <tr><td>FCM1L:</td><td><input type="number" id="p_FCM1L" /></td></tr>
      <tr><td>SM1L:</td><td><input type="number" id="p_SM1L" /></td></tr>
    </table>
    <div style="text-align:center">
      <button onclick="saveCustomPrices()">üíæ Save</button>
      <button onclick="closeModal()">‚ùå Cancel</button>
    </div>
  </div>  <script>
    const prices = { TM500: 56, S_Milk: 45, S_Curd: 45, B_Curd: 68, H500: 86, FCM500: 77, FCM1L: 72, SM1L: 66 };
    const STORAGE_KEY = 'daily_retail_sales_data_v1';
    const customPrices = new WeakMap();
    let currentEditingRow = null;

    function loadAllData() { try { const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : {}; } catch (e) { console.error('loadAllData', e); return {}; } }
    function saveAllData(obj) { localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }

    function saveCurrentDate() {
      const date = document.getElementById('dateField').value; if (!date) return; const tbody = document.getElementById('salesBody'); const rows = Array.from(tbody.rows).map(r => Array.from(r.querySelectorAll('input')).map(i => i.value)); const all = loadAllData(); all[date] = rows; saveAllData(all); updateTotals();
    }

    function loadDate(date) { const all = loadAllData(); const tbody = document.getElementById('salesBody'); tbody.innerHTML = ''; if (all[date] && all[date].length) all[date].forEach(cells => insertRowFromArray(cells)); else { const dates = Object.keys(all).sort().reverse(); if (dates.length) { const last = dates[0]; if (all[last] && all[last].length) all[last].forEach(cells => insertRowFromArray(cells)); } } updateTotals(); }

    function insertRowFromArray(values) {
      const tbody = document.getElementById('salesBody'); const row = document.createElement('tr'); let idx = 0;
      row.innerHTML = `\n        <td><input type='text' value='${values[idx++] || ''}'></td>\n        <td><input class='mobile-input' type='text' value='${values[idx++] || ''}'></td>`;
      for (let i = 0; i < 8; i++) row.innerHTML += `<td><input type='number' min='0' value='${values[idx++] || ''}' onchange='calcTotal(this)'></td>`;
      row.innerHTML += `<td><input class='paid-input' type='number' min='0' value='${values[idx++] || ''}' readonly></td>`;
      row.innerHTML += `<td><input class='due-input' type='number' min='0' value='${values[idx++] || ''}'></td>`;
      row.innerHTML += `<td><button class='edit' onclick='editRow(this)'>‚úèÔ∏è Edit</button></td>`;
      row.innerHTML += `<td><button class='send' onclick='sendWhatsApp(this)'>üì§ Send</button></td>`;
      row.innerHTML += `<td><button class='delete' onclick='confirmDelete(this)'>‚ùå</button></td>`;
      tbody.appendChild(row);
      Array.from(row.querySelectorAll('input[type="number"]')).forEach(i => i.onchange && i.onchange());
    }

    function addRow() { const tbody = document.getElementById('salesBody'); const row = document.createElement('tr'); row.innerHTML = `\n        <td><input type='text' placeholder='Name'></td>\n        <td><input class='mobile-input' type='text' placeholder='Mobile'></td>\n        ${Array(8).fill(`<td><input type='number' min='0' onchange='calcTotal(this)'></td>`).join('')}\n        <td><input class='paid-input' type='number' min='0' readonly></td>\n        <td><input class='due-input' type='number' min='0'></td>\n        <td><button class='edit' onclick='editRow(this)'>‚úèÔ∏è Edit</button></td>\n        <td><button class='send' onclick='sendWhatsApp(this)'>üì§ Send</button></td>\n        <td><button class='delete' onclick='confirmDelete(this)'>‚ùå</button></td>`; tbody.appendChild(row); }

    function editRow(btn) { currentEditingRow = btn.parentElement.parentElement; const currentPrices = customPrices.get(currentEditingRow) || prices; for (const key in prices) document.getElementById('p_' + key).value = currentPrices[key]; document.getElementById('priceModal').style.display = 'block'; }
    function saveCustomPrices() { if (!currentEditingRow) return; const newPrices = {}; for (const key in prices) newPrices[key] = parseFloat(document.getElementById('p_' + key).value) || prices[key]; customPrices.set(currentEditingRow, newPrices); document.getElementById('priceModal').style.display = 'none'; calcTotal(currentEditingRow.querySelector('input[type="number"]')); }
    function closeModal() { document.getElementById('priceModal').style.display = 'none'; }

    function calcTotal(el) { const row = el.parentElement.parentElement; const rowPrices = customPrices.get(row) || prices; const inputs = Array.from(row.querySelectorAll('input')); const qtys = inputs.slice(2, 10).map(i => parseFloat(i.value) || 0); const total = qtys[0]*rowPrices.TM500 + qtys[1]*rowPrices.S_Milk + qtys[2]*rowPrices.S_Curd + qtys[3]*rowPrices.B_Curd + qtys[4]*rowPrices.H500 + qtys[5]*rowPrices.FCM500 + qtys[6]*rowPrices.FCM1L + qtys[7]*rowPrices.SM1L; const paidInput = row.querySelector('.paid-input'); const dueInput = row.querySelector('.due-input'); if (paidInput) paidInput.value = total.toFixed(2); if (dueInput && dueInput.value==='') dueInput.value = '0.00'; saveCurrentDate(); updateTotals(); }

    function updateTotals() { const totals = { TM500: 0, S_Milk: 0, S_Curd: 0, B_Curd: 0, H500: 0, FCM500: 0, FCM1L: 0, SM1L: 0, totalAmount: 0 }; document.querySelectorAll('#salesBody tr').forEach(row => { const inputs = Array.from(row.querySelectorAll('input')); const qtys = inputs.slice(2, 10).map(i => parseFloat(i.value) || 0); totals.TM500 += qtys[0]; totals.S_Milk += qtys[1]; totals.S_Curd += qtys[2]; totals.B_Curd += qtys[3]; totals.H500 += qtys[4]; totals.FCM500 += qtys[5]; totals.FCM1L += qtys[6]; totals.SM1L += qtys[7]; const rowPrices = customPrices.get(row) || prices; totals.totalAmount += qtys[0]*rowPrices.TM500 + qtys[1]*rowPrices.S_Milk + qtys[2]*rowPrices.S_Curd + qtys[3]*rowPrices.B_Curd + qtys[4]*rowPrices.H500 + qtys[5]*rowPrices.FCM500 + qtys[6]*rowPrices.FCM1L + qtys[7]*rowPrices.SM1L; }); document.getElementById('t_TM500').innerText = totals.TM500.toFixed(1) + 'L'; document.getElementById('t_S_Milk').innerText = totals.S_Milk.toFixed(1) + 'L'; document.getElementById('t_S_Curd').innerText = totals.S_Curd.toFixed(1) + 'L'; document.getElementById('t_B_Curd').innerText = totals.B_Curd.toFixed(1) + 'L'; document.getElementById('t_H500').innerText = totals.H500.toFixed(1) + 'L'; document.getElementById('t_FCM500').innerText = totals.FCM500.toFixed(1) + 'L'; document.getElementById('t_FCM1L').innerText = totals.FCM1L.toFixed(1) + 'L'; document.getElementById('t_SM1L').innerText = totals.SM1L.toFixed(1) + 'L'; document.getElementById('totalDisplay').innerText = 'Total: ‚Çπ' + totals.totalAmount.toFixed(2); document.getElementById('grandTotal').innerText = 'Grand Total: ‚Çπ' + totals.totalAmount.toFixed(2); }

    function openPrintView(){
      // Build printable HTML
      const date = document.getElementById('dateField').value || '';
      let html = `<html><head><title>Invoice - ${date}</title><style>body{font-family:Arial;padding:12px}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ccc;padding:6px;text-align:center}</style></head><body>`;html += `<h2>Daily Sales - ${date}</h2>`;
  html += `<table><thead>${document.querySelector('#salesTable thead').innerHTML}</thead><tbody>`;
  document.querySelectorAll('#salesBody tr').forEach(r=>{
    html += '<tr>' + Array.from(r.querySelectorAll('input')).slice(0,12).map(i=>`<td>${i.value || ''}</td>`).join('') + '</tr>';
  });
  html += `</tbody></table><h3>${document.getElementById('grandTotal').innerText}</h3></body></html>`;
  const w = window.open('','_blank');
  w.document.write(html);
  w.document.close();
  w.focus();
  setTimeout(()=>{ w.print(); },300);
}

function sendWhatsApp(btn) { const row = btn.parentElement.parentElement; const inputs = Array.from(row.querySelectorAll('input')); const name = inputs[0].value || 'Customer'; const mobile = inputs[1].value.replace(/\D/g, ''); const paid = inputs[10].value || 0; const due = inputs[11].value || 0; if (!mobile) return alert('Enter mobile number to send invoice.'); const date = document.getElementById('dateField').value; const message = `Hi ${name},%0AHere is your bill for ${date}.%0APaid: ‚Çπ${paid}%0ADue: ‚Çπ${due}`; window.open(`https://wa.me/${mobile}?text=${message}`, '_blank'); }

function confirmDelete(btn) { if (confirm('Are you sure you want to delete this customer entry?')) { btn.parentElement.parentElement.remove(); saveCurrentDate(); updateTotals(); } }

function updateDate() {
  const date = document.getElementById('dateField').value;
  // update only the date title text so we don't overwrite the total spans
  document.getElementById('dateTitle').textContent = `Daily Retail Sales Tracker ‚Äì ${date}`;
  loadDate(date);
}`; loadDate(date); }

window.addEventListener('beforeunload', saveCurrentDate);
window.addEventListener('load', () => { const today = new Date().toISOString().slice(0, 10); document.getElementById('dateField').value = today; updateDate(); // ensure at least one row visible for quick entry
  setTimeout(()=>{ if(document.getElementById('salesBody').rows.length===0) addRow(); }, 120); });

  </script>
</body>
</html>
