<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Retail Sales Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9fafb; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #e2e8f0; }
    button { padding: 4px 8px; border: none; border-radius: 5px; cursor: pointer; }
    .edit { background: #38bdf8; color: white; }
    .send { background: #22c55e; color: white; }
    .delete { background: #ef4444; color: white; }
    input[type='number'], input[type='text'] { width: 70px; text-align: center; }
    #priceModal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; border:1px solid #ccc; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); }
    #priceModal input { width:80px; }
    #priceModal button { margin-top:10px; }
  </style>
</head>
<body>
  <h1>üßæ Daily Retail Sales Tracker</h1>
  <label><strong>Date:</strong> <input type="date" id="dateField" onchange="updateDate()" /></label>
  <table id="salesTable">
    <thead>
      <tr>
        <th>Customer Name</th>
        <th>Mobile</th>
        <th>TM500</th>
        <th>S Milk</th>
        <th>S Curd</th>
        <th>B Curd</th>
        <th>H500</th>
        <th>FCM500</th>
        <th>FCM1L</th>
        <th>SM1L</th>
        <th>Paid (‚Çπ)</th>
        <th>Due (‚Çπ)</th>
        <th>Edit</th>
        <th>Send</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="salesBody"></tbody>
  </table>
  <button onclick="addRow()">‚ûï Add Customer</button>  <div id="priceModal">
    <h3>Edit Prices for Customer</h3>
    <table>
      <tr><td>TM500:</td><td><input type="number" id="p_TM500" /></td></tr>
      <tr><td>S Milk:</td><td><input type="number" id="p_S_Milk" /></td></tr>
      <tr><td>S Curd:</td><td><input type="number" id="p_S_Curd" /></td></tr>
      <tr><td>B Curd:</td><td><input type="number" id="p_B_Curd" /></td></tr>
      <tr><td>H500:</td><td><input type="number" id="p_H500" /></td></tr>
      <tr><td>FCM500:</td><td><input type="number" id="p_FCM500" /></td></tr>
      <tr><td>FCM1L:</td><td><input type="number" id="p_FCM1L" /></td></tr>
      <tr><td>SM1L:</td><td><input type="number" id="p_SM1L" /></td></tr>
    </table>
    <button onclick="saveCustomPrices()">Save</button>
    <button onclick="closeModal()">Cancel</button>
  </div>  <script>
    const prices = { TM500: 56, S_Milk: 45, S_Curd: 45, B_Curd: 68, H500: 86, FCM500: 77, FCM1L: 72, SM1L: 66 };
    const STORAGE_KEY = 'daily_retail_sales_data_v1';
    const customPrices = new WeakMap(); // store custom prices per row

    function loadAllData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : {};
      } catch (e) { console.error('loadAllData', e); return {}; }
    }

    function saveAllData(obj) { localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }

    function saveCurrentDate() {
      const date = document.getElementById('dateField').value;
      if (!date) return;
      const tbody = document.getElementById('salesBody');
      const rows = Array.from(tbody.rows).map(r => Array.from(r.querySelectorAll('input')).map(i => i.value));
      const all = loadAllData();
      all[date] = rows;
      saveAllData(all);
    }

    function loadDate(date) {
      const all = loadAllData();
      const tbody = document.getElementById('salesBody');
      tbody.innerHTML = '';
      if (all[date] && all[date].length) all[date].forEach(cells => insertRowFromArray(cells));
      else {
        const dates = Object.keys(all).sort().reverse();
        if (dates.length) {
          const last = dates[0];
          if (all[last] && all[last].length) all[last].forEach(cells => insertRowFromArray(cells));
        }
      }
    }

    function insertRowFromArray(values) {
      const tbody = document.getElementById('salesBody');
      const row = document.createElement('tr');
      let idx = 0;
      row.innerHTML = `
        <td><input type='text' value='${values[idx++] || ''}'></td>
        <td><input type='text' value='${values[idx++] || ''}'></td>`;
      for (let i = 0; i < 8; i++) row.innerHTML += `<td><input type='number' min='0' value='${values[idx++] || ''}' onchange='calcTotal(this)'></td>`;
      row.innerHTML += `<td><input type='number' min='0' value='${values[idx++] || ''}' onchange='calcTotal(this)'></td>`;
      row.innerHTML += `<td><input type='number' min='0' value='${values[idx++] || ''}'></td>`;
      row.innerHTML += `<td><button class='edit' onclick='editRow(this)'>‚úèÔ∏è</button></td>`;
      row.innerHTML += `<td><button class='send' onclick='sendWhatsApp(this)'>üì§</button></td>`;
      row.innerHTML += `<td><button class='delete' onclick='deleteRow(this)'>‚ùå</button></td>`;
      tbody.appendChild(row);
      Array.from(row.querySelectorAll('input[type="number"]')).forEach(i => i.onchange && i.onchange());
    }

    function addRow() {
      const tbody = document.getElementById('salesBody');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input type='text' placeholder='Name'></td>
        <td><input type='text' placeholder='Mobile'></td>
        ${Array(8).fill(`<td><input type='number' min='0' onchange='calcTotal(this)'></td>`).join('')}
        <td><input type='number' min='0' onchange='calcTotal(this)'></td>
        <td><input type='number' min='0'></td>
        <td><button class='edit' onclick='editRow(this)'>‚úèÔ∏è</button></td>
        <td><button class='send' onclick='sendWhatsApp(this)'>üì§</button></td>
        <td><button class='delete' onclick='deleteRow(this)'>‚ùå</button></td>`;
      tbody.appendChild(row);
    }

    let currentEditingRow = null;

    function editRow(btn) {
      currentEditingRow = btn.parentElement.parentElement;
      const currentPrices = customPrices.get(currentEditingRow) || prices;
      for (const key in prices) {
        document.getElementById('p_' + key).value = currentPrices[key];
      }
      document.getElementById('priceModal').style.display = 'block';
    }

    function saveCustomPrices() {
      if (!currentEditingRow) return;
      const newPrices = {};
      for (const key in prices) {
        newPrices[key] = parseFloat(document.getElementById('p_' + key).value) || prices[key];
      }
      customPrices.set(currentEditingRow, newPrices);
      document.getElementById('priceModal').style.display = 'none';
      calcTotal(currentEditingRow.querySelector('input[type="number"]'));
    }

    function closeModal() {
      document.getElementById('priceModal').style.display = 'none';
    }

    function calcTotal(el) {
      const row = el.parentElement.parentElement;
      const rowPrices = customPrices.get(row) || prices;
      const inputs = Array.from(row.querySelectorAll('input'));
      const qtys = inputs.slice(2, 10).map(i => parseFloat(i.value) || 0);
      const total = qtys[0]*rowPrices.TM500 + qtys[1]*rowPrices.S_Milk + qtys[2]*rowPrices.S_Curd + qtys[3]*rowPrices.B_Curd + qtys[4]*rowPrices.H500 + qtys[5]*rowPrices.FCM500 + qtys[6]*rowPrices.FCM1L + qtys[7]*rowPrices.SM1L;
      const paid = parseFloat(inputs[10].value || 0);
      const dueInput = inputs[11];
      if (dueInput) dueInput.value = (total - paid).toFixed(2);
      saveCurrentDate();
    }

    function sendWhatsApp(btn) {
      const row = btn.parentElement.parentElement;
      const inputs = Array.from(row.querySelectorAll('input'));
      const name = inputs[0].value || 'Customer';
      const mobile = inputs[1].value.replace(/\D/g, '');
      const paid = inputs[10].value || 0;
      const due = inputs[11].value || 0;
      if (!mobile) return alert('Enter mobile number to send invoice.');
      const date = document.getElementById('dateField').value;
      const message = `Hi ${name},%0AHere is your bill for ${date}.%0APaid: ‚Çπ${paid}%0ADue: ‚Çπ${due}`;
      window.open(`https://wa.me/${mobile}?text=${message}`, '_blank');
    }

    function deleteRow(btn) { btn.parentElement.parentElement.remove(); saveCurrentDate(); }

    function updateDate() {
      const date = document.getElementById('dateField').value;
      document.querySelector('h1').innerText = `üßæ Daily Retail Sales Tracker ‚Äì ${date}`;
      loadDate(date);
    }

    window.addEventListener('beforeunload', saveCurrentDate);
    window.addEventListener('load', () => {
      const today = new Date().toISOString().slice(0, 10);
      document.getElementById('dateField').value = today;
      updateDate();
    });
  </script></body>
</html>
